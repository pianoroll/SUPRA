
{% include_relative listeners.html %}

<script>
// vim: ts=3


//////////////////////////////
//
// displayReferences --
//

function displayReferences(list, selector) {
	if (!Array.isArray(list)) {
		list = [ list ];
	}
	list.sort(function(a, b) {
		if (!a) {
			return -1;
		}
		if (!b) {
			return -1;
		}
		if (Array.isArray(a)) {
			a = a[0];
		}
		if (Array.isArray(b)) {
			b = b[0];
		}
		var Aauthor = a.AUTHOR;
		var Bauthor = b.AUTHOR;
		if (!Aauthor) {
			return +1;
		}
		if (!Bauthor) {
			return -1;
		}
		return Aauthor.localeCompare(Bauthor);
	});

	var output = "";
	for (var i=0; i<list.length; i++) {
		output += "<p class='hangingindent'>";
		output += prepareEntry(list, i);
		output += "</p>";
	}

	var element = document.querySelector(selector);
	if (!element) {
		console.log("COULD NOT FIND SELECTOR", selector);
		return;
	}
	element.innerHTML = output;
}



//////////////////////////////
//
//  prepareEntry --
//

function prepareEntry(list, index) {
	var entry = list[index];
	if (!entry) {
		return "";
	}
	var output = "";
	var author = "";
	if (entry.AUTHOR) {
		author = entry.AUTHOR.replace(/[{}]/g, "");
	}
	if (author) {
		output += author + ". ";
	}
	var title = entry.TITLE;
	var subtitle = entry.SUBTITLE;
	var url = entry.URL;
	if (url) {
		output += "<a target='_blank' href='" + url + "'>";
	}
	output += title;
	if (subtitle) {
		output += ": ";
		output += subtitle;
	}
	if (url) {
		output += "</a>";
	}
	var rtype = entry.TYPE;
	if (rtype && rtype.match(/dissertation/i)) {
		output += ", Ph.D. diss.";
	}
	var location = entry.LOCATION;
	var publisher = entry.PUBLISHER;
	if (location && publisher) {
		output += ", " + location + ": " + publisher;
	} else if (location) {
		output += ", " + location;
	} else if (publisher) {
		output += ", " + publisher;
	}
	var year = entry.YEAR;
	if (year) {
		output += "; " + year;
	}
	

	if (entry.PAGE) {
		if (entry.PAGE.match(/-/)) {
			output += ", pp.&nbsp;" + entry.PAGE.replace(/-+/g, "&ndash;") + ".";
		} else {
			output += ", p.&nbsp;" + entry.PAGE + ".";
		}
	} else {
		output += ".";
	}

	var newoutput = "";
	newoutput += "<details>";
	newoutput += "<summary>";
	newoutput += output;
	newoutput += "</summary>";

	if (entry.ANNOTATION) {
		newoutput += entry.ANNOTATION;
	}

	newoutput += "</details>";

	return newoutput;
}

</script>


<script>
// vim: ts=3


//////////////////////////////
//
// displayLinks --
//

function displayLinks(list, selector) {
	if (!Array.isArray(list)) {
		list = [ list ];
	}
/*
	list.sort(function(a, b) {
		if (!a) {
			return -1;
		}
		if (!b) {
			return -1;
		}
		if (Array.isArray(a)) {
			a = a[0];
		}
		if (Array.isArray(b)) {
			b = b[0];
		}
		var Aauthor = a.AUTHOR;
		var Bauthor = b.AUTHOR;
		if (!Aauthor) {
			return +1;
		}
		if (!Bauthor) {
			return -1;
		}
		return Aauthor.localeCompare(Bauthor);
	});
*/

	var output = "";
	for (var i=0; i<list.length; i++) {
		output += prepareLinkEntry(list, i);
	}

	var element = document.querySelector(selector);
	if (!element) {
		console.log("COULD NOT FIND SELECTOR", selector);
		return;
	}
	element.innerHTML = output;
}



//////////////////////////////
//
//  prepareLinkEntry --
// 
// @@BEGIN: LINK
// @URL:		https://digital.deutsches-museum.de/projekte/notenrollen/rollentypen/welte_rot_t100/
// @URL2:		https://digital.deutsches-museum.de/projekte/notenrollen/
// @TITLE:		{Description of the Red/T100 Welte roll type} from the {Notenrollensammlung des Deutches Museum}
// @ANNOTATION:	Contains a discussion about seven different paper colors that
// 		are used to produce red welte rolls: three shades of pink, red, green, 
//			off-white and white.
// @TOPIC:		Roll Formats
// @SUBTOPIC:	Red Welte roll
// @@END: LINK
//

function prepareLinkEntry(list, index) {
	var entry = list[index];
	if (!entry) {
		return "";
	}
	var output = "";
	var title = entry.TITLE;
	if (!title) {
		return "";
	}
	title = title.replace(/}/g, "</a>");
	title = title.replace(/{/g, "XplaceholderX");
	if (entry.URL) {
		title = title.replace(/XplaceholderX/, "<a target='_blank' href='" + entry.URL + "'>");
	}
	if (entry.URL2) {
		title = title.replace(/XplaceholderX/, "<a target='_blank' href='" + entry.URL2 + "'>");
	}
	if (entry.URL3) {
		title = title.replace(/XplaceholderX/, "<a target='_blank' href='" + entry.URL3 + "'>");
	}
	if (entry.URL4) {
		title = title.replace(/XplaceholderX/, "<a target='_blank' href='" + entry.URL4 + "'>");
	}
	if (entry.URL5) {
		title = title.replace(/XplaceholderX/, "<a target='_blank' href='" + entry.URL5 + "'>");
	}
	output += "<details>";
	output += "<summary>";
	output += title;
	output += "</summary>";
	if (entry.ANNOTATION) {
		output += entry.ANNOTATION;
	}
	output += "</details>";

	return output;
}

</script>



