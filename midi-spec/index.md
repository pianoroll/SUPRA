---
title: SUPRA MIDI file descriptions
author: Craig Stuart Sapp
keywords: midi
permalink: /midi-spec/index.html
vim: ts=3
summary: 
---

# SUPRA MIDI files #

This page describes the format for MIDI files available in the SUPRA
archive.  There are two types of MIDI files: (1) "raw" MIDI files,
where each musical hole on the physical roll is represented by a
note in the MIDI data, and (2) "expressive" MIDI files, where the
individual holes have been merged into single notes (debridged),
note durations have been extended slightly due to the width of the
tracker bar, and expression controls on the left/right sides of the
roll are interpreted as attack velocities for notes (as sustain/soft
pedals controls added).

MIDI files can be accessed with three methods:

<ol>

<li> <a target="_blank" href="https://github.com/pianoroll/SUPRA">SUPRA
Github repository</a>: This repository allows for downloading all
files, either via the <i>git</i> program, or via a link to a zip
file found on the repository homepage. </li>

<li> <a target="_blank" href="/">SUPRA homepage</a>: For each entry
on the list of music on the SUPRA homepage, there are links to the
"raw" and "expressive" MIDI files on the right side of the listings.
Right click on the "Mraw" or "Mexp" links to save the MIDI file to
your local computer. </li>

<li> <a target="_blank" href="https://purl.stanford.edu/zw904vm6502">PURL
pages</a>: the expressive MIDI file is available in the download
section of the image viewer found on the PURL pages (bottom left
corner of the image window).  </li>

</ol>

## Raw MIDI files ##

<a target="_new" href="https://ccrma.stanford.edu/~craig/piano-roll-project/redwelte-20180301/yg150mb0559/yg150mb0559-analysis/analysis-4.jpg"><img style="float:right; margin-right:-100px; margin-top:0px;" src="rawrednote.png"></a>

For every hole in the original roll, a MIDI note will be stored in
the "raw" MIDI file.  These holes may represent single notes, but
typically need to be grouped into musical notes.  The image on the
right shows an analysis of the roll image.  Each red/orange/yellow
bounding box around a hole is represented by a MIDI note in the raw
MIDI file; however, these five holes actually represent a sigle
musical note.  The raw MIDI files contain an estimation of these
groupings by giving a loud note attack to the start of the expected
musical note (marked with the yellow line in the image), and holes
that sustain the note are given a quite note attack (holes that
have the orange line at the top of their bounding box.  Notice the
difference between "holes" and "punches": A "punch" is a circular
hole generated by a circular stamp used to create holes in the roll
paper.  A "hole" can be a single punch (in which case it should be
circular), or it can be an overlap of several punches.  In the
example image there are five "holes" that represent eight punches.

The individual holes can be merged with further processing into a
single note according to the <b>BRIDGE_FACTOR</b> parameter (see
metadata further below).  The raw MIDI file is not intended for
listing purposes, but rather as input for further processing to
produce recuts (making copies of the original paper rolls).  The
image on the right illustrages a series of holes on a piano roll
that represent a single note.  Each of the boxes that bound a hole
on the roll is converted into a separate MIDI note in the "raw"
MIDI file.

Expression holes are given a quiet note attack for proof listening.
Regular note holes are also played softly unless initial analysis
by the image processing software identifies the hole as the start
of a note, in which case the note hole is played loudly.  Note that
the expression is not interpreted/applied to the "raw" MIDI file.

There are five tracks in the "raw" MIDI file:
<ul>
<li> Track 0: tempo settings for acceleration emulation and metadata parameters.</li>
<li> Track 1: Note holes in the bass register, using MIDI channel 2.</li>
<li> Track 2: Note holes in the treble register, using MIDI channel 3.</li>
<li> Track 3: Expression holes for the bass register, using MIDI channel 4.</li>
<li> Track 4: Expression holes for the treble register, using MIDI channel 5.</li>
</ul>

### Timing ###

In both the "raw" and "expressive" MIDI files, the (initial) tempo
of the roll is stored in the ticks-per-quarter-note
(pulses-per-quarter-note) parameter of the MIDI file header.  For
most digitized rolls, the roll tempo will be this value divided by
6.  For example if the tick-per-quarter-note value is 600, then
this means that the roll tempo marking is "100".  Each MIDI
tick is equivalent to one pixel row in the original image.

The tick values represent rows in the scanned image.  Since most
rolls are scanned at 300 DPI (or more precisely 300.25 DPI), then
a roll tempo of 100, meaning 10.0 feet/minute, equals 10.0 * 12 *
300 = 36000 pixels rows per minute.  For each second that is 36000
/ 60 sec/min = 600 pixel rows per second, which is the setting used
for the ticks-per-second in the MIDI file header.  In other words,
ticks in the MIDI file directly represent pixel lines in the scan
of the MIDI file from which the MIDI file was digitized.
DEA rolls will have a different multiplication factor other than 6 (but
these have not been scanned yet).

Time 0 in the MIDI file is the position of the first automatically
identified musical note hole in the image, which is at the image
row given in the <b>FIRST_HOLE</b> metadata parameter.  If the first
"musical" hole is an expression hole, the final "expressive" MIDI
file may have silence at the start of the MIDI file, since the
expression holes are silenced or removed from the expressive MIDI
files.  Sometimes the first identified hole is a random tear in the
MIDI file (and these are not manually corrected).

### Acceleration emulation ###

Raw MIDI files will usually include acceleration emulation in the
tempo track (track 0).  When a roll is performed on a mechanical
instrument, the winding mechanism pulling the roll around the take-up
spool is rotating at a constant speed. As the paper builds up the
diameter of the take-up spool, the speed at which the paper is
moving will increase.  This is estimated to be 0.22%/foot, so every
3600 ticks in the MIDI file, there will be an updated tempo value
which is 0.22% greater than the previous tempo.  The effect of tempo
acceleration is needed for rolls greater than about 100 feet, since the
end of the roll will otherwise sound like it is slowing down without
the emulation.

Note that the tempo meta messages in the MIDI file are only used for 
acceleration emulation.  The "tempo" of the roll is found in the MIDI
header, in the ticks-per-quarter-note parameter.  This allows for the
acceleration emulation and the starting tempo to be set independently.
This also allows for the tick values in the MIDI file to represent
pixel rows in the original image.

## Expressive MIDI files ##

The expressive MIDI files are generated from the "raw" MIDI file.  There
are several pre-processing steps: (1) remove the bridging from the raw holes
by merging holes that are closer than the <b>BRIDGE_FACTOR</b> parameter
in the metadata found in track 0; (2) tracker-bar holes have a height which
will increase the effective length of holes after bridging has been removed.
After these two steps have been done, the dynamics of each register are
modeled and applied to the velocities of the sounding notes.  Typically the
expression tracks (tracks 3 and 4 will be removed from the final expressive
MIDI file), so there are usually 3 MIDI tracks in the expressive MIDI files:

<ul>
<li> Track 0: tempo indications and metadata parameters.</li>
<li> Track 1: Note holes in the bass register, using MIDI channel 2.</li>
<li> Track 2: Note holes in the treble register, using MIDI channel 3.</li>
</ul>

Expression MIDI file add additional metadata parameter that describe how
the realization of the velocities was calculated (see the metadata
section below for more information).

## Metadata parameters ##

All SUPRA MIDI files contain metadata fields describing the MIDI
file, such as the title, composer, and performer, as well as detailed
parameters describing the analysis of the original roll image and
interpretation of expression applied to the roll.  The metadata is
stored as text meta messages in the tempo track of the MIDI file.
Each parameter is stored in a separate text meta message.  The basic
structure of an entry is:

```
@KEY: VALUE
```

In other words, the parameter key is prefixed by an `@` character
and is followed by a `:` character.  The KEY does not contain
spaces, but uses underscores to represent spaces in the parameter
name.  The value contains any number of characters, with accented
letters in title/composer/performer names represented by hexadecimal
unicode numeric entities, such as "&#xE9" for the letter "Ã©" (this
encoding is taken directly from the Stanford Libraries' XML catkey
entries for the rolls).  The order of the parameters is not fixed, 
since processing of the MIDI file may rearrange the ordering.

Metadata parameters can be extracted SUPRA MIDI files using the <a
target="_blank"
href="https://github.com/pianoroll/midiroll/blob/master/tools/rolltext.cpp">rolltext</a>
program (to be described more later).

All metadata entries from all files in the SUPRA digital archive 
are available in <a target="_blank" href="https://github.com/pianoroll/SUPRA/blob/master/index.aton">this file</a> 
in the <a target="_blank" href="https://github.com/pianoroll/SUPRA">SUPRA Github repository</a>.
The file can be converted into JSON data by using the <a target="_blank" href="https://aton.sapp.org"> ATON Javascript library</a>.
Additionally, you can view this metadata in the JavaScript console of your browser by typing the variable name <b>ROLLINFO</b>:


<figure class="figure">
  <img src="rollinfo.png" width="800" class="figure-img img-fluid center-block rounded" alt="figure.">
</figure>




{% include_relative metadata.html %}

<div style="height:300px"></div>

{% include_relative styles-local.html %}
{% include_relative scripts-local.html %}



